<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report1_subreport1" pageWidth="555" pageHeight="802" columnWidth="555" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="042ce3d5-ef68-4075-a0cb-740c00b0bc76">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="id" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="paymentdate" class="java.util.Date">
		<property name="paymentdate" value="$F{paymentdate}"/>
		<defaultValueExpression><![CDATA[$P{paymentdate}]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
	cast (to_timestamp(o.createddate/1000) as date) foodDate,
	p.surname ||' ' ||p.firstname ||' '|| p.secondname || ' (' || od.menudetailname ||')' client,
	o.ordertype
from cf_orders o
	inner join cf_clients cl on cl.idofclient = o.idofclient
	inner join cf_persons p on cl.idofperson = p.idofperson
	inner join cf_orderdetails od on od.idoforder = o.idoforder and od.idoforg = o.idoforg
    INNER JOIN CF_Clients_CategoryDiscounts cc ON cc.idofclient = cl.idofclient
where
	cast (to_timestamp(o.createddate/1000) as date) <> $P{paymentdate}
and cast (to_timestamp(o.orderdate/1000) as date) = $P{paymentdate}
    and o.createddate  BETWEEN '1441051200000' and '1441310399000' -- здесь должны быть входные даты отчета
	and od.menutype  between '50' and '99'
	and o.ordertype in (4,6)
    and o.state = 0
    AND cc.idOfCategoryDiscount IN (2, 5, 3, 4, 20, 1, 104, 105, 106, 108, 112, 121, 122, 123, 124)
    and o.idoforg = $P{id}]]>
	</queryString>
	<field name="foodDate" class="java.lang.String"/>
	<field name="client" class="java.lang.String"/>
	<field name="groupName" class="java.lang.String"/>
	<group name="groupName" isStartNewColumn="true">
		<groupExpression><![CDATA[$F{groupName}]]></groupExpression>
		<groupHeader>
			<band height="30">
				<textField>
					<reportElement uuid="a6f36032-0177-4d61-9258-58683c56294d" isPrintRepeatedValues="false" x="0" y="0" width="555" height="30">
						<printWhenExpression><![CDATA[!$F{foodDate}.isEmpty()]]></printWhenExpression>
					</reportElement>
					<box>
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="14" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA["Дата предоставления питания " + $F{foodDate}]]></textFieldExpression>
				</textField>
			</band>
			<band height="30">
				<textField>
					<reportElement uuid="992b17ba-5cda-4b86-a3bb-5fae20c75661" x="0" y="0" width="555" height="30">
						<printWhenExpression><![CDATA[!$F{groupName}.isEmpty()]]></printWhenExpression>
					</reportElement>
					<box>
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font size="14" isBold="false"/>
					</textElement>
					<textFieldExpression><![CDATA["  " + $F{groupName}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<detail>
		<band height="30" splitType="Stretch">
			<textField>
				<reportElement uuid="fea66af3-e599-4a4f-903e-39937de5c07a" x="0" y="0" width="555" height="30"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="14" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA["    "+ $F{client}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
