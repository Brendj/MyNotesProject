<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:ui="http://java.sun.com/jsf/facelets">

    <!--<% if (!MainPage.getSessionInstance().isEligibleToEditCards()) { out.println("Недостаточно прав для просмотра страницы"); return; } %>-->

    <h:panelGrid>
        <h:panelGrid rendered="#{!mainPage.isEligibleToEditCards()}">
            <h:outputText escape="true" styleClass="output-text"
                          value="Недостаточно прав для просмотра страницы">
            </h:outputText>
        </h:panelGrid>

        <!-- Панель редактирования данных карты -->
        <h:panelGrid id="cardEditGrid" binding="#{mainPage.cardEditPage.pageComponent}" styleClass="borderless-grid"
                     columns="2" rendered="#{mainPage.isEligibleToEditCards()}">
            <h:outputText escape="true" value="Клиент" styleClass="output-text"/>
            <h:panelGroup styleClass="borderless-div">
                <h:inputText value="#{mainPage.cardEditPage.client.shortName}" readonly="true" styleClass="input-text"
                             style="margin-right: 2px;"/>
                <a4j:commandButton value="..." action="#{mainPage.showClientSelectPage}"
                                   render="modalClientSelectorPanel"
                                   oncomplete="if (#{facesContext.maximumSeverity == null}) #{rich:component('modalClientSelectorPanel')}.show();"
                                   styleClass="command-link" style="width: 25px;"/>
            </h:panelGroup>
            <h:outputText escape="true" value="Номер карты" styleClass="output-text"/>
            <h:inputText value="#{mainPage.cardEditPage.cardNo}" converter="cardNoConverter" readonly="true"
                         maxlength="18"
                         styleClass="input-text"/>
            <h:outputText escape="true" value="Длинный номер карты" styleClass="output-text"/>
            <h:inputText value="#{mainPage.cardEditPage.longCardNo}" converter="cardNoConverter" readonly="true"
                         maxlength="18"
                         styleClass="input-text"/>
            <h:outputText escape="true" value="Номер, нанесенный на карту" styleClass="output-text"/>
            <h:inputText value="#{mainPage.cardEditPage.cardPrintedNo}" converter="cardPrintedNoConverter"
                         readonly="true"
                         maxlength="18"
                         styleClass="input-text"/>
            <h:outputText escape="true" value="Внешний идентификатор" styleClass="output-text"/>
            <h:inputText value="#{mainPage.cardEditPage.externalId}" styleClass="input-text"/>
            <h:outputText escape="true" value="Тип карты" styleClass="output-text"/>
            <h:selectOneMenu value="#{mainPage.cardEditPage.cardType}" styleClass="input-text">
                <f:selectItems value="#{mainPage.cardEditPage.cardTypeMenu.items}"/>
            </h:selectOneMenu>
            <h:outputText escape="true" value="Дата выдачи" styleClass="output-text"/>
            <rich:calendar value="#{mainPage.cardEditPage.issueTime}" datePattern="dd.MM.yyyy" converter="dateConverter"
                           inputClass="input-text" showWeeksBar="false"/>
            <h:outputText escape="true" value="Последний день действия" styleClass="output-text"/>
            <rich:calendar value="#{mainPage.cardEditPage.validTime}" datePattern="dd.MM.yyyy" converter="dateConverter"
                           inputClass="input-text" showWeeksBar="false"/>
            <h:outputText escape="true" value="Статус карты" styleClass="output-text"/>
            <h:panelGroup>
                <h:selectOneMenu value="#{mainPage.cardEditPage.state}"
                                 rendered="#{mainPage.cardEditPage.state != 4}"
                                 styleClass="input-text">
                    <f:selectItems value="#{mainPage.cardEditPage.cardStateMenu.items}"/>
                </h:selectOneMenu>
                <a4j:commandButton value="Возврат карты"
                                   render="mainMenu, workspaceForm"
                                   action="#{mainPage.cardEditPage.returnCard(request.remoteUser)}"
                                   rendered="#{mainPage.cardEditPage.state == 4}"/>
            </h:panelGroup>
            <h:outputText escape="true" value="Причина блокировки карты" styleClass="output-text"/>
            <h:selectOneMenu value="#{mainPage.cardEditPage.lockReasonState}" styleClass="input-text">
                <f:selectItems value="#{mainPage.cardEditPage.cardLockReasonMenu.items}"/>
            </h:selectOneMenu>
            <h:outputText escape="true" value="Статус расположения карты" styleClass="output-text"/>
            <h:selectOneMenu value="#{mainPage.cardEditPage.lifeState}" styleClass="input-text">
                <f:selectItems value="#{mainPage.cardEditPage.cardLifeStateMenu.items}"/>
            </h:selectOneMenu>
        </h:panelGrid>
        <h:panelGrid columns="2" styleClass="borderless-grid">
            <a4j:commandButton value="Сохранить" action="#{mainPage.updateCard}" render="mainMenu, workspaceTogglePanel"
                               styleClass="command-button"/>
            <a4j:commandButton value="Восстановить" action="#{mainPage.showCardEditPage}"
                               render="mainMenu, workspaceTogglePanel" ajaxSingle="true" styleClass="command-button"/>
        </h:panelGrid>
        <h:panelGrid styleClass="borderless-grid">
            <rich:messages styleClass="messages" errorClass="error-messages" infoClass="info-messages"
                           warnClass="warn-messages"/>
        </h:panelGrid>
    </h:panelGrid>
</ui:composition>
