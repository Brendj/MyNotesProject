<?xml version="1.0" encoding="UTF-8"?>
<beans
        xmlns='http://www.springframework.org/schema/beans'
        xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
        xmlns:jaxws='http://cxf.apache.org/jaxws'
        xsi:schemaLocation="http://www.springframework.org/schema/beans
  http://www.springframework.org/schema/beans/spring-beans.xsd
  http://cxf.apache.org/jaxws
  http://cxf.apache.org/schemas/jaxws.xsd">

    <bean id="contextCapture" class="ru.axetta.ecafe.processor.core.utils.CxfContextCapture"/>

    <bean id="wsCryptoProperties"
          class="org.springframework.beans.factory.config.PropertiesFactoryBean">
        <property name="singleton" value="true"/>
        <property name="properties">
            <props>
                <prop key="org.apache.ws.security.crypto.provider">org.apache.ws.security.components.crypto.Merlin
                </prop>
                <prop key="org.apache.ws.security.crypto.merlin.keystore.type">JKS</prop>
                <prop key="org.apache.ws.security.crypto.merlin.keystore.password">123456</prop>
                <prop key="org.apache.ws.security.crypto.merlin.file">/temp/certs/alice.jks</prop>
                <prop key="org.apache.ws.security.crypto.merlin.truststore.type">PKCS12</prop>
                <prop key="org.apache.ws.security.crypto.merlin.truststore.password">BCGG00</prop>
                <prop key="org.apache.ws.security.crypto.merlin.truststore.file">/temp/certs/ispp_agent_istk.pfx</prop>
            </props>
        </property>
    </bean>

    <bean id="signRequest" class="org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor">
        <constructor-arg>
            <map>
                <entry key="action" value="Signature"/>
                <entry key="wss4j.processor.map">
                    <map key-type="javax.xml.namespace.QName">
                        <entry value="null">
                            <key>
                                <bean class="javax.xml.namespace.QName">
                                    <constructor-arg
                                            value="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"/>
                                    <constructor-arg value="Timestamp"/>
                                </bean>
                            </key>
                        </entry>
                    </map>
                </entry>
                <!--<entry key="signaturePropFile" value="bob.properties"/>
        <entry key="decryptionPropFile" value="bob.properties"/>-->
                <entry key="signaturePropRefId" value="signatureProperties"/>
                <entry key="signatureProperties" value-ref="wsCryptoProperties"/>

                <entry key="passwordCallbackClass" value="ru.axetta.ecafe.processor.web.internal.KsPasswordCallback"/>
            </map>
        </constructor-arg>
    </bean>


    <bean id="noRequestSecurity" class="org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor">
        <constructor-arg>
            <map>
                <entry key="action" value="NoSecurity"/>
            </map>
        </constructor-arg>
    </bean>


    <bean id="signResponse" class="org.apache.cxf.ws.security.wss4j.WSS4JOutInterceptor">
        <constructor-arg>
            <map>
                <entry key="action" value="Timestamp"/>
                <entry key="user" value="939d6862-52b9-490e-9bac-d88cee5ccb3f"/>
                <entry key="signaturePropRefId" value="signatureProperties"/>
                <!-- The entry that actually contains the Properties object for
the signature crypto configuration.  See SignaturePropRefId. -->
                <entry key="signatureProperties" value-ref="wsCryptoProperties"/>
                <!--      <entry key="signaturePropFile" value="bob.properties"/>-->
                <!--        <entry key="encryptionPropFile" value="bob.properties"/>
        <entry key="encryptionUser" value="Alice"/>-->
                <!--                <entry key="signatureKeyIdentifier" value="DirectReference"/>
                <entry key="encryptionKeyIdentifier" value="DirectReference"/>-->
                <entry key="passwordCallbackClass" value="ru.axetta.ecafe.processor.web.internal.KsPasswordCallback"/>
                <entry key="signatureParts"
                       value="{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body"/>
            </map>
        </constructor-arg>
    </bean>

    <bean id="wsLoggingInInterceptor" class="ru.axetta.ecafe.processor.web.partner.WSLoggingInInterceptor"/>

    <jaxws:endpoint
            id="FrontController"
            address='http://localhost:8080/processor/soap/front'
            implementor='ru.axetta.ecafe.processor.web.internal.FrontController'>
        <!--        <jaxws:inInterceptors>
            <bean class="org.apache.cxf.interceptor.LoggingInInterceptor"/>
            <ref bean="signRequest"/>
            <bean class="org.apache.cxf.binding.soap.saaj.SAAJInInterceptor"/>
        </jaxws:inInterceptors>
        <jaxws:outInterceptors>
            <bean class="org.apache.cxf.binding.soap.saaj.SAAJOutInterceptor"/>
            <ref bean="signResponse"/>
            <bean class="org.apache.cxf.interceptor.LoggingOutInterceptor"/>
        </jaxws:outInterceptors>-->
    </jaxws:endpoint>
    <jaxws:endpoint
            id="NSIDeltaController"
            address='http://localhost:8080/processor/soap/nsi_delta'
            implementor='ru.axetta.ecafe.processor.web.partner.nsi.NSIDeltaController'>
        <jaxws:inInterceptors>
            <ref bean="wsLoggingInInterceptor"/>
        </jaxws:inInterceptors>
    </jaxws:endpoint>
    <jaxws:endpoint
            id="PaymentControllerWS"
            address='http://localhost:8080/processor/soap/payment'
            implementor='ru.axetta.ecafe.processor.web.partner.integra.soap.PaymentControllerWS'>
    </jaxws:endpoint>
    <jaxws:endpoint
            id="ClientRoomControllerWS"
            address='http://localhost:8080/processor/soap/client'
            implementor='ru.axetta.ecafe.processor.web.partner.integra.soap.ClientRoomControllerWS'>
        <jaxws:inInterceptors>
            <bean class="ru.axetta.ecafe.processor.web.util.RemoveSecurityHeaderSoapInterceptor"/>
        </jaxws:inInterceptors>
    </jaxws:endpoint>
    <jaxws:endpoint
            id="DashboardServiceWS"
            address='http://localhost:8080/processor/soap/dashboard'
            implementor='ru.axetta.ecafe.processor.dashboard.DashboardServiceWS'>
    </jaxws:endpoint>

    <jaxws:endpoint
            id="IntegraControllerWS"
            address='http://localhost:8080/processor/soap/integro'
            implementor='ru.axetta.ecafe.processor.web.internal.report.ReportControllerWS'>
    </jaxws:endpoint>

    <jaxws:endpoint
            id="RegularPaymentWS"
            address='http://localhost:8080/processor/soap/regpay'
            implementor='ru.axetta.ecafe.processor.web.partner.acquiropay.soap.RegularPaymentWS'/>

    <jaxws:endpoint
            id="POSPaymentControllerWS"
            address='http://localhost:8080/processor/soap/pos'
            implementor='ru.axetta.ecafe.processor.web.partner.integra.soap.POSPaymentControllerWS'>
    </jaxws:endpoint>


</beans>
